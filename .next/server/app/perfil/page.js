(()=>{var e={};e.id=550,e.ids=[550],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},3491:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c});var r=t(482),a=t(9108),i=t(2563),l=t.n(i),n=t(8300),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);t.d(s,o);let c=["",{children:["perfil",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,919)),"C:\\Users\\Carlos\\sl\xf1al\\src\\app\\perfil\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,1342)),"C:\\Users\\Carlos\\sl\xf1al\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,4117)),"C:\\Users\\Carlos\\sl\xf1al\\src\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,8206)),"C:\\Users\\Carlos\\sl\xf1al\\src\\app\\not-found.tsx"]}],d=["C:\\Users\\Carlos\\sl\xf1al\\src\\app\\perfil\\page.tsx"],u="/perfil/page",x={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/perfil/page",pathname:"/perfil",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5693:(e,s,t)=>{Promise.resolve().then(t.bind(t,8653))},8653:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var r=t(5344),a=t(3729),i=t(8428),l=t(7435),n=t(5094),o=t(573),c=t(8120),d=t(5299),u=t(5944);function x(){(0,u.e)({requireAuth:!0,fallback:"/"});let e=(0,i.useRouter)(),s=(0,l.createPagesBrowserClient)(),[t,x]=(0,a.useState)(null),[m,p]=(0,a.useState)(""),[h,g]=(0,a.useState)([]),[f,j]=(0,a.useState)({}),[b,y]=(0,a.useState)([]),[N,_]=(0,a.useState)(!0),[w,v]=(0,a.useState)(!0),[q,C]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{let{data:{session:t}}=await s.auth.getSession();if(!t){e.push("/login");return}x(t),p(t.user.email||"");let{data:r}=await s.from("user_courses").select("courses(id, title, description, image)").eq("user_id",t.user.id),a=r?.map(e=>e.courses)||[];g(a);let i={};for(let e of a){let{data:r}=await s.from("modules").select("id").eq("course_id",e.id),{data:a}=await s.from("user_progress").select("module_id").eq("user_id",t.user.id),l=r?.length||0,n=a?.filter(e=>r?.some(s=>s.id===e.module_id)).length||0;i[e.id]={completed:n,total:l}}j(i),_(!1);let{data:l}=await s.from("payments").select("id, amount, status, paid_at, mp_payment_id, courses(title)").eq("user_id",t.user.id).order("paid_at",{ascending:!1});y(l||[]),v(!1)})()},[e,s]);let P=async()=>{await s.auth.signOut(),e.push("/login")},k=async()=>{if(!m)return;let{error:e}=await s.auth.resetPasswordForEmail(m);e||alert("Te enviamos un enlace para cambiar la contrase\xf1a a tu correo.")};return(0,r.jsxs)("main",{className:"min-h-screen bg-gray-50 px-4 py-8",children:[(0,r.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,r.jsxs)("header",{className:"mb-10 flex justify-between items-center",children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold text-sky-700 flex items-center gap-2",children:[r.jsx(o.Z,{className:"w-6 h-6"})," Perfil de usuario"]}),(0,r.jsxs)(n.z,{onClick:P,variant:"outline",className:"flex items-center gap-2",children:[r.jsx(c.Z,{className:"w-5 h-5"})," Cerrar sesi\xf3n"]})]}),(0,r.jsxs)("section",{className:"bg-white p-6 rounded-xl shadow mb-8",children:[r.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Datos personales"}),(0,r.jsxs)("p",{className:"text-gray-700 mb-2",children:["Correo electr\xf3nico: ",r.jsx("strong",{children:m})]}),r.jsx("div",{className:"flex gap-4 mt-4",children:r.jsx(n.z,{variant:"outline",onClick:k,children:"Cambiar contrase\xf1a"})})]}),(0,r.jsxs)("section",{className:"mb-12",children:[r.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Tus cursos"}),N?r.jsx("p",{children:"Cargando cursos..."}):0===h.length?r.jsx("p",{className:"text-gray-500",children:"A\xfan no est\xe1s inscripto en ning\xfan curso."}):r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.map(s=>(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow p-4 flex flex-col",children:[r.jsx("img",{src:s.image,alt:s.title,className:"w-full h-40 object-cover rounded mb-4"}),r.jsx("h3",{className:"text-lg font-bold mb-2",children:s.title}),r.jsx("p",{className:"text-gray-600 text-sm mb-2 flex-1",children:s.description}),f[s.id]?.total>0&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:["Progreso: ",f[s.id].completed," de"," ",f[s.id].total," m\xf3dulos"]}),r.jsx("div",{className:"w-full h-2 bg-gray-200 rounded-full",children:r.jsx("div",{className:"h-2 bg-emerald-500 rounded-full",style:{width:`${f[s.id].completed/f[s.id].total*100}%`}})})]}),(0,r.jsxs)(n.z,{onClick:()=>e.push(`/mi-curso/${s.id}`),className:"mt-auto flex items-center gap-2",children:["Ir al curso ",r.jsx(d.Z,{className:"w-4 h-4"})]})]},s.id))})]}),(0,r.jsxs)("section",{className:"mb-12",children:[r.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Facturaci\xf3n"}),r.jsx(n.z,{onClick:()=>C(!0),children:"Ver historial de pagos"})]})]}),q&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white w-full max-w-xl rounded-xl shadow-lg p-6 relative",children:[r.jsx("button",{onClick:()=>C(!1),className:"absolute top-3 right-4 text-gray-500 hover:text-red-600 text-xl",children:"\xd7"}),r.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Historial de pagos"}),w?r.jsx("p",{children:"Cargando pagos..."}):0===b.length?r.jsx("p",{className:"text-gray-500",children:"A\xfan no realizaste pagos."}):r.jsx("ul",{className:"space-y-4 max-h-96 overflow-y-auto",children:b.map(e=>(0,r.jsxs)("li",{className:"border rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[r.jsx("span",{className:"font-medium",children:e.courses?.title||"Curso eliminado"}),r.jsx("span",{className:"text-sm text-gray-600",children:new Date(e.paid_at).toLocaleDateString()})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm text-gray-700",children:[(0,r.jsxs)("span",{children:["Estado: ",r.jsx("strong",{children:e.status})]}),(0,r.jsxs)("span",{children:["Monto: $",e.amount]})]}),t?.user.id&&r.jsx("a",{href:`/api/descargar-factura?paymentId=${e.mp_payment_id}&userId=${t.user.id}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-sky-700 underline mt-1 inline-block",children:"Descargar factura"})]},e.id))})]})})]})}},919:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>a,default:()=>l});let r=(0,t(6843).createProxy)(String.raw`C:\Users\Carlos\slÃ±al\src\app\perfil\page.tsx`),{__esModule:a,$$typeof:i}=r,l=r.default}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[638,328,24],()=>t(3491));module.exports=r})();