"use strict";(()=>{var e={};e.id=464,e.ids=[464],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},5003:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>q,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>g});var a={};r.r(a),r.d(a,{GET:()=>d});var s=r(5419),o=r(9108),i=r(9678),n=r(8070),u=r(5564),p=r(6323);async function d(e){let t=e.nextUrl.searchParams,r=t.get("paymentId"),a=t.get("userId");if(!r||!a)return new Response("Faltan par\xe1metros",{status:400});let s=(0,p.eI)("https://qdinmvlhendpkjimagnq.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),{data:o}=await s.from("payments").select("*, courses(title)").eq("user_id",a).eq("mp_payment_id",r).maybeSingle();if(!o)return new Response("Factura no encontrada",{status:404});let i=await u.PDFDocument.create(),d=i.addPage([600,400]),c=await i.embedFont(u.StandardFonts.Helvetica);d.drawText("Factura de compra",{x:50,y:350,size:20,font:c}),d.drawText(`Curso: ${o.courses?.title||"Curso"}`,{x:50,y:310,size:14,font:c}),d.drawText(`Importe: $${o.amount}`,{x:50,y:290,size:14,font:c}),d.drawText(`Pago ID: ${o.mp_payment_id}`,{x:50,y:270,size:14,font:c}),d.drawText(`Fecha: ${new Date(o.paid_at).toLocaleDateString()}`,{x:50,y:250,size:14,font:c});let l=await i.save();return new n.Z(l,{status:200,headers:{"Content-Type":"application/pdf","Content-Disposition":`attachment; filename=Factura-${r}.pdf`}})}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/descargar-factura/route",pathname:"/api/descargar-factura",filename:"route",bundlePath:"app/api/descargar-factura/route"},resolvedPagePath:"C:\\Users\\Carlos\\sl\xf1al\\src\\app\\api\\descargar-factura\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:x,headerHooks:f,staticGenerationBailout:g}=c,q="/api/descargar-factura/route";function h(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[638,206,323,564],()=>r(5003));module.exports=a})();