(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[518],{912:function(e,s,t){Promise.resolve().then(t.bind(t,91))},91:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return h}});var l=t(3827),a=t(4090),r=t(7907),n=t(8714),i=t(575),d=t(3879),o=t(4562),c=t(8539),u=t(1825),m=t(9109);function h(){let e=(0,r.useRouter)(),s=(0,n.createPagesBrowserClient)(),{id:t}=(0,r.useParams)(),[h,x]=(0,a.useState)(null),[p,g]=(0,a.useState)([]),[f,b]=(0,a.useState)(null),[j,N]=(0,a.useState)(null),[w,y]=(0,a.useState)(!1),[_,v]=(0,a.useState)({}),[C,k]=(0,a.useState)(!0),[S,q]=(0,a.useState)({completedCount:0,totalModules:0}),[E,M]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{let{data:{session:l}}=await s.auth.getSession();if(N(l),!l){e.push("/login");return}let{data:a}=await s.from("user_courses").select("*").eq("user_id",l.user.id).eq("course_id",t).maybeSingle();if(!a){e.push("/curso/".concat(t));return}y(!0);let{data:r}=await s.from("courses").select("*").eq("id",t).single(),{data:n}=await s.from("modules").select("*").eq("course_id",t).order("order_number"),{data:i}=await s.from("user_progress").select("*").eq("user_id",l.user.id),d={};null==i||i.forEach(e=>{d[e.module_id]=e.completed});let o=(null==n?void 0:n.length)||0,c=(null==n?void 0:n.filter(e=>d[e.id]).length)||0;x(r),g(n||[]),b((null==n?void 0:n[0])||null),v(d),q({completedCount:c,totalModules:o}),M(o>0&&c===o),k(!1)})()},[t,e,s]);let P=async(e,l)=>{await s.from("user_progress").upsert([{user_id:j.user.id,module_id:e,completed:!l}]);let a={..._,[e]:!l};v(a);let r=p.filter(e=>a[e.id]).length,n=p.length,i=r===n;q({completedCount:r,totalModules:n}),M(i),i&&await s.from("user_courses").update({completed:!0}).eq("user_id",j.user.id).eq("course_id",t)};return C?(0,l.jsx)("p",{className:"p-6 text-center",children:"Cargando curso..."}):h?(0,l.jsx)("main",{className:"min-h-screen bg-white px-4 py-8",children:(0,l.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,l.jsxs)("header",{className:"flex justify-between mb-6",children:[(0,l.jsxs)(i.z,{variant:"outline",onClick:()=>e.push("/dashboard"),children:[(0,l.jsx)(d.Z,{className:"w-4 h-4 mr-2"})," Dashboard"]}),(0,l.jsx)(i.z,{variant:"outline",onClick:()=>e.push("/explorar"),children:"Explorar cursos"})]}),(0,l.jsxs)("article",{children:[(0,l.jsx)("img",{src:h.image,alt:h.title,className:"w-full h-60 object-cover rounded-xl mb-6"}),(0,l.jsx)("h1",{className:"text-3xl font-bold text-sky-700 mb-2",children:h.title}),(0,l.jsx)("p",{className:"text-gray-600 mb-2",children:h.description}),(0,l.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Categor\xeda: ",h.category," | Dificultad: ",h.difficulty]})]}),E&&(0,l.jsxs)("div",{className:"mb-6 flex items-center gap-2 text-emerald-600",children:[(0,l.jsx)(o.Z,{className:"w-5 h-5"})," Curso completado"]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,l.jsxs)("aside",{className:"bg-gray-50 p-4 rounded-lg shadow-sm",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"M\xf3dulos"}),(0,l.jsx)("ul",{className:"space-y-2",children:p.map(e=>(0,l.jsxs)("li",{onClick:()=>b(e),className:"cursor-pointer p-2 rounded flex justify-between items-center ".concat((null==f?void 0:f.id)===e.id?"bg-sky-100 font-semibold":"hover:bg-gray-100"),children:[(0,l.jsxs)("span",{children:[e.order_number,". ",e.title]}),_[e.id]&&(0,l.jsx)("span",{className:"text-emerald-600",children:"âœ“"})]},e.id))})]}),(0,l.jsxs)("section",{className:"lg:col-span-3 bg-white p-6 rounded-xl shadow-sm",children:[S.totalModules>0&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("p",{className:"text-sm font-medium mb-1",children:["Completaste ",S.completedCount," de ",S.totalModules," m\xf3dulos"]}),(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4",children:(0,l.jsx)("div",{className:"bg-emerald-500 h-4 rounded-full transition-all duration-300",style:{width:"".concat(S.completedCount/S.totalModules*100,"%")}})})]}),f?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("h3",{className:"text-xl font-bold mb-4",children:[f.order_number,". ",f.title]}),(0,l.jsx)("div",{className:"prose prose-sm max-w-none mb-6",children:(0,l.jsx)(c.UG,{remarkPlugins:[u.Z],rehypePlugins:[m.Z],children:f.content})}),(0,l.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:_[f.id]||!1,onChange:()=>P(f.id,_[f.id]||!1)}),"Marcar como completado"]})]}):(0,l.jsx)("p",{children:"Seleccion\xe1 un m\xf3dulo para comenzar."})]})]})]})}):(0,l.jsx)("p",{className:"p-6 text-center text-red-600",children:"Curso no encontrado."})}},575:function(e,s,t){"use strict";t.d(s,{z:function(){return a}});var l=t(3827);t(4090);let a=e=>{let{children:s,variant:t="default",className:a,...r}=e;return(0,l.jsx)("button",{className:"".concat("px-4 py-2 rounded font-medium transition"," ").concat({default:"bg-indigo-600 text-white hover:bg-indigo-700",outline:"border border-gray-300 text-gray-800 hover:bg-gray-100"}[t]," ").concat(a),...r,children:s})}}},function(e){e.O(0,[51,714,967,971,69,744],function(){return e(e.s=912)}),_N_E=e.O()}]);